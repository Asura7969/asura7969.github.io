<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Asura7969 Blog</title><meta name="keywords" content="java,bigdata"><meta name="author" content="Asura7969"><meta name="copyright" content="Asura7969"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Asura7969 Blog">
<meta property="og:url" content="https://asura7969.github.io/page/2/index.html">
<meta property="og:site_name" content="Asura7969 Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://asura7969.github.io/img/shanyi.jpg">
<meta property="article:author" content="Asura7969">
<meta property="article:tag" content="java,bigdata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://asura7969.github.io/img/shanyi.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://asura7969.github.io/page/2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Asura7969 Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-02-17 21:20:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/shanyi.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/img/hexobackground.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Asura7969 Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Asura7969 Blog</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/Asura7969" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1402357969@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/03/08/Unaligned%20Checkpointing/" title="Unaligned Checkpointing">     <img class="post_bg" src="/img/topimg/202105161056.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Unaligned Checkpointing"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/03/08/Unaligned%20Checkpointing/" title="Unaligned Checkpointing">Unaligned Checkpointing</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-08T00:31:57.000Z" title="发表于 2021-03-08 08:31:57">2021-03-08</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">Unaligned Checkpointing背景Flink Checkpoint 基于 Chandy-Lamport 算法实现的。
目前的 Checkpoint 算法在大多数情况下运行良好，然而当作业出现反压时，阻塞式的 Barrier 对齐反而会加剧作业的反压，甚至导致作业的不稳定。
当前checkpoint机制

当operator 接收到 第一个 barrier (b1) 时，会把其所在的后续数据写入 buffer ，直到 buffer 写满阻塞 channel
同时处理其它未接受到 barrier (b1) 的 channel，这些 channel 的数据会输出到该 operator 的 outputChannel中，往下游节点发送
当所有channel接受到 barrier (b1) 后，该 operator 会先往 outputChannel 发送 b1,再把 buffer 中的数据与 channel 中的后续数据输出到下游

Unaligned Checkpoint


当第一个barrier (b1) 快到达 operator 时，会优先处理 barrier(b1)， ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/03/07/Flink%201.12.0%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/" title="Flink 1.12.0源码编译">     <img class="post_bg" src="https://i.loli.net/2021/05/16/7ySFcK6aLv1MBZm.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink 1.12.0源码编译"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/03/07/Flink%201.12.0%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/" title="Flink 1.12.0源码编译">Flink 1.12.0源码编译</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-07T00:31:57.000Z" title="发表于 2021-03-07 08:31:57">2021-03-07</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">本机环境操作系统：win10
1234567891011121314151617181920&gt; scala -versionScala code runner version 2.12.12 -- Copyright 2002-2020, LAMP/EPFL and Lightbend, Inc.&gt; java -versionjava version &quot;1.8.0_271&quot;Java(TM) SE Runtime Environment (build 1.8.0_271-b09)Java HotSpot(TM) 64-Bit Server VM (build 25.271-b09, mixed mode)&gt; mvn -versionApache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)Maven home: E:\apache-maven-3.6.3\bin\..Java version: 1.8.0_261, vendor: Oracle Corporation, runtime: ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/03/07/FLIP30%E8%AF%91%E6%96%87/" title="FLP-30 Unified Catalog APIs译文">     <img class="post_bg" src="/img/topimg/202105161055.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="FLP-30 Unified Catalog APIs译文"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/03/07/FLIP30%E8%AF%91%E6%96%87/" title="FLP-30 Unified Catalog APIs译文">FLP-30 Unified Catalog APIs译文</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-07T00:31:57.000Z" title="发表于 2021-03-07 08:31:57">2021-03-07</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">背景随着其在流处理中的广泛采用，Flink也显示了其在批处理中的潜力。 改进Flink的批处理，尤其是在SQL方面，将使Flink在流处理之外得到更大的采用，并为用户提供一套完整的解决方案，以满足他们的流和批处理需求。另一方面，Hive已将重点放在大数据技术及其完整的生态系统上。 对于大多数大数据用户而言，Hive不仅是用于大数据分析和ETL的SQL引擎，还是一个数据管理平台，可以在该平台上查询，定义和演化数据。 换句话说，Hive是Hadoop上大数据的事实上的标准。因此，Flink必须与Hive生态系统集成，以进一步将其扩展到批处理和SQL用户。 为此，必须与Hive元数据和数据集成。
Hive Metastore集成有两个方面：1.使Hive的元对象（如表和视图）可供Flink使用，并且Flink也能够为Hive和在Hive中创建此类元对象； 2.使用Hive Metastore作为持久性存储，使Flink的元对象（表，视图和UDF）持久化。本文档涵盖Flink和Hive生态系统集成的三个部分之一。 它不仅涉及Hive集成，还涉及重新构建目录界面以及TableEnvironmen ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/03/04/Flink%20Checkpoint%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B/" title="Flink Checkpoint 恢复流程">     <img class="post_bg" src="/img/topimg/202105161039.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink Checkpoint 恢复流程"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/03/04/Flink%20Checkpoint%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B/" title="Flink Checkpoint 恢复流程">Flink Checkpoint 恢复流程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-04T00:31:57.000Z" title="发表于 2021-03-04 08:31:57">2021-03-04</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">Checkpoint简介Flink定期保存数据，failover后从上次成功的保存点处恢复，并提供Exactly-Once的投递保障机制
CheckpointCoordinator123456789101112131415161718192021222324252627282930313233// 恢复保存点public boolean restoreSavepoint(        String savepointPointer,        boolean allowNonRestored,        Map&lt;JobVertexID, ExecutionJobVertex&gt; tasks,        ClassLoader userClassLoader) throws Exception &#123;    Preconditions.checkNotNull(savepointPointer, &quot;The savepoint path cannot be null.&quot;);    LOG.info(&quot;Starting job &# ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/02/21/Flink%E6%96%B9%E6%A1%88%E8%AE%B0%E5%BD%95/" title="Flink方案记录">     <img class="post_bg" src="/img/topimg/202105161042.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink方案记录"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/02/21/Flink%E6%96%B9%E6%A1%88%E8%AE%B0%E5%BD%95/" title="Flink方案记录">Flink方案记录</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-21T00:31:57.000Z" title="发表于 2021-02-21 08:31:57">2021-02-21</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">flink 快慢流双流join
1、自定义UDF函数，join不到sleep一下
2、在join operator处数据等一会再查
3、如果没有join到,把数据重新回流,等再次消费后再次join
4、如果source端的MQ支持延迟消息，直接使用MQ的延迟功能(例如kafka的时间轮)
5、扩展Flink Source,例如在Kafka Connector中加入time.wait属性,当用户设置这个属性就让source的数据等一会
6、对于未匹配上的数据可以先导入外部存储,后续进行匹配  
7、如果source端是kafka,数据在写入kafka时候设置key（后续的join key）的值,使得同key的数据延迟度降低

flink 作业迁移注意事项flink对接kafka, kafka offset如何保证?背景:kafka与yarn集群同时迁移到新集群,保证flink作业不丢数据。使用kafka mirror,从原有kafka集群copy数据到新集群,flink作业做savepoint,地址是新集群地址,在新的yarn集群上启动flink作业。注意:必要时可以使用state pr ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/02/20/Flink%20Graph/" title="Flink Graph">     <img class="post_bg" src="/img/topimg/202105161043.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink Graph"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/02/20/Flink%20Graph/" title="Flink Graph">Flink Graph</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-20T00:31:57.000Z" title="发表于 2021-02-20 08:31:57">2021-02-20</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">StreamGraph是通过用户的Stream API编写的代码生成最初的图，用来表示程序的拓扑结构

StreamNode：用来代表operator的类，并具有所有相关的属性，如并发度、入边和出边等。
StreamEdge：表示连接两个StreamNode的边。

JobGraphStreamGraph经过优化后生成JobGraph，提交给JobManager数据结构。主要是将多个符合条件的节点chain在一起作为一个节点，这样可以减少数据在节点之间流动所需的序列化/反序列化/传输消耗。

JobVertex：经过优化后符合条件的多个StreamNode可能会chain在一起生成一个JobVertex，即一个JobVertex包含一个或多个operator，JobVertex的输入是JobEdge，输出是IntermediateDataSet。
IntermediateDataSet：表示JobVertex的输出，即经过operator处理产生的数据集。producer是JobVertex，consumer是JobEdge。
JobEdge：代表了job graph中的一条数据传输通 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/02/05/%E9%A2%84%E6%B5%8B%E7%AE%97%E6%B3%95/" title="预测算法">     <img class="post_bg" src="/img/topimg/202105161044.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="预测算法"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/02/05/%E9%A2%84%E6%B5%8B%E7%AE%97%E6%B3%95/" title="预测算法">预测算法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-02-05T00:31:57.000Z" title="发表于 2021-02-05 08:31:57">2021-02-05</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/python/">python</a></span></div><div class="content">环境安装conda1234567891011121314151617181920# 安装的模块conda list# 创建指不定版本的环境conda create -n pEvn3_7 python=3.7# 环境激活脚本source activate pEvn3_7# 安装模块conda install -n pEvn3_7 [package]# 退出环境source deactivate# 安装tensorflowpip install tensorflow==1.15# 卸载tensorflowpip uninstall tensorflow
prophet1conda install -c conda-forge fbprophet

算法库statsmodels
算法示例指数平滑算法
</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/01/06/Expand%20Flink%20Sql/" title="Expand Flink Sql">     <img class="post_bg" src="/img/topimg/202105161045.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Expand Flink Sql"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/01/06/Expand%20Flink%20Sql/" title="Expand Flink Sql">Expand Flink Sql</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-01-06T00:31:57.000Z" title="发表于 2021-01-06 08:31:57">2021-01-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">扩展format
输入数据格式
12ANALYSIS,2020-08-06 17:20:24.066,2,&#123;&quot;condition&quot;:&#123;&quot;mail&quot;:&quot;zhangsan@qq.com&quot;,&quot;guid&quot;:&quot;1111111&quot;,&quot;request_id&quot;:&quot;b1ca18645f03e01abfd9bcfe5b2e0f3a&quot;,&quot;status&quot;:&quot;200&quot;&#125;,&quot;entityMata&quot;:&#123;&quot;ipAddress&quot;:&quot;0.0.0.0&quot;,&quot;logValue&quot;:2.0,&quot;metric&quot;:&quot;metric1&quot;,&quot;service&quot;:&quot;service1&quot;&#125;,&quot;traceId&quot;:&quot;385307967614d7 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/24/Flink%20Retraction%20Mechanism/" title="Flink Retraction">     <img class="post_bg" src="/img/topimg/202105161046.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink Retraction"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/24/Flink%20Retraction%20Mechanism/" title="Flink Retraction">Flink Retraction</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-24T00:31:57.000Z" title="发表于 2020-12-24 08:31:57">2020-12-24</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/flink/">flink</a></span></div><div class="content">Flink Retraction MechanismFlink Sql最终生成Physical Planning后会对每个RelNode打标,判断当前RelNode是哪种ChangelogMode
FlinkChangelogModeInferenceProgram
12345678910111213141516171819202122232425262728293031323334353637383940414243444546override def optimize(    root: RelNode,    context: StreamOptimizeContext): RelNode = &#123;  // step1: 确定每个节点的变更类型  // 先从source节点开始标记节点属于哪种 ModifyKindSetTrait(I,U,D,Empty)  val physicalRoot = root.asInstanceOf[StreamPhysicalRel]  val rootWithModifyKindSet = SATISFY_MODIFY_KIND_SET ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/23/Flink%20Sql%20SMJ/" title="Flink Sql SMJ">     <img class="post_bg" src="/img/topimg/202105161047.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink Sql SMJ"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/23/Flink%20Sql%20SMJ/" title="Flink Sql SMJ">Flink Sql SMJ</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-23T00:31:57.000Z" title="发表于 2020-12-23 08:31:57">2020-12-23</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/sql/">sql</a></span></div><div class="content">Sort Merge Join简介
1.In most cases, its performance is weaker than HashJoin.


2.It is more stable than HashJoin, and most of the data can be sorted stably.


3.SortMergeJoin should be the best choice if sort can be omitted in the case of multi-level join cascade with the same key.

Join流程除了sort、spill、merge，join流程大致与spark类似
源码BinaryExternalSorter分别包含3个异步线程(sort, spill, merger)，三个线程通过circularQueues实现通信

SortingThread
123456789101112131415161718192021222324252627282930313233343536373839404142434445 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/#content-inner">3</a><a class="extend next" rel="next" href="/page/3/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/shanyi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Asura7969</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Asura7969"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Asura7969" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1402357969@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/kakafka%E5%8D%87%E7%BA%A7-Security/" title="kakafka升级-Security"><img src="/img/topimg/202202172112.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="kakafka升级-Security"/></a><div class="content"><a class="title" href="/2022/02/17/kakafka%E5%8D%87%E7%BA%A7-Security/" title="kakafka升级-Security">kakafka升级-Security</a><time datetime="2022-02-17T13:11:12.000Z" title="发表于 2022-02-17 21:11:12">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/kafka-SCRAM-ACL%E9%85%8D%E7%BD%AE/" title="kafka &amp;&amp; SCRAM + ACL配置"><img src="/img/topimg/202111111633.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="kafka &amp;&amp; SCRAM + ACL配置"/></a><div class="content"><a class="title" href="/2022/02/17/kafka-SCRAM-ACL%E9%85%8D%E7%BD%AE/" title="kafka &amp;&amp; SCRAM + ACL配置">kafka &amp;&amp; SCRAM + ACL配置</a><time datetime="2022-02-17T13:04:36.000Z" title="发表于 2022-02-17 21:04:36">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/08/15/Flink-RPC/" title="Flink RPC"><img src="/img/topimg/20210815013700.png" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink RPC"/></a><div class="content"><a class="title" href="/2021/08/15/Flink-RPC/" title="Flink RPC">Flink RPC</a><time datetime="2021-08-14T17:31:33.000Z" title="发表于 2021-08-15 01:31:33">2021-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/05/15/Mini-Batch-%E7%BB%B4%E8%A1%A8-Join/" title="Mini-Batch 维表 Join"><img src="/img/topimg/20210515223350.jpg" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Mini-Batch 维表 Join"/></a><div class="content"><a class="title" href="/2021/05/15/Mini-Batch-%E7%BB%B4%E8%A1%A8-Join/" title="Mini-Batch 维表 Join">Mini-Batch 维表 Join</a><time datetime="2021-05-15T14:38:45.000Z" title="发表于 2021-05-15 22:38:45">2021-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/04/27/Flink%20SQL%E8%A7%A3%E6%9E%90(%E4%BA%8C)/" title="Flink Sql解析(二)"><img src="/img/topimg/20210515223338.jpg" onerror="this.onerror=null;this.src='/img/404-b.jpg'" alt="Flink Sql解析(二)"/></a><div class="content"><a class="title" href="/2021/04/27/Flink%20SQL%E8%A7%A3%E6%9E%90(%E4%BA%8C)/" title="Flink Sql解析(二)">Flink Sql解析(二)</a><time datetime="2021-04-27T00:31:57.000Z" title="发表于 2021-04-27 08:31:57">2021-04-27</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/flink/"><span class="card-category-list-name">flink</span><span class="card-category-list-count">12</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/java/"><span class="card-category-list-name">java</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kafka/"><span class="card-category-list-name">kafka</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/python/"><span class="card-category-list-name">python</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/rpc/"><span class="card-category-list-name">rpc</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/shuffle/"><span class="card-category-list-name">shuffle</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/spark/"><span class="card-category-list-name">spark</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/sql/"><span class="card-category-list-name">sql</span><span class="card-category-list-count">6</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/flink/" style="font-size: 1.5em; color: #99a9bf">flink</a> <a href="/tags/java/" style="font-size: 1.1em; color: #999">java</a> <a href="/tags/kafka/" style="font-size: 1.23em; color: #999ea6">kafka</a> <a href="/tags/python/" style="font-size: 1.1em; color: #999">python</a> <a href="/tags/spark/" style="font-size: 1.37em; color: #99a4b2">spark</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">八月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">五月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">四月 2021</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/03/"><span class="card-archive-list-date">三月 2021</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">十二月 2020</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">30</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-02-17T13:20:18.587Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Asura7969</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>